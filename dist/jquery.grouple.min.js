/*! Grouple - v0.1.0 - 2012-05-07
* https://github.com/jonaphin/grouple
* Copyright (c) 2012 Jonathan Lancar; Licensed MIT */
(function(a){var b=function(b,d){var e=this;this.items=[],this.settings=a.extend({},d),this.id=this.settings.id,this.subsetClassName="grouple-subset-"+this.id,this.container=b,this.canvasWidth=a(b).width(),this.canvasHeight=a(b).height(),this.centerX=this.canvasWidth/2,this.centerY=this.canvasHeight/2,this.radiusOuterEnd=(this.centerX<this.centerY?this.centerX:this.centerY)*.9,this.radiusInner=this.radiusOuterEnd*.6,this.radiusOuterInit=this.radiusInner+(this.radiusOuterEnd-this.radiusInner)/2,this.radiusSubsetsRail=this.radiusInner+(this.radiusOuterInit-this.radiusInner)/2,this.radiusSubcircle=function(){return e.radiusOuterEnd-e.radiusSubsetsRail},this.radiusCurrent=this.radiusOuterEnd,this.bounds={x:[a(b).position().left,a(b).position().left+e.canvasWidth],y:[a(b).position().top,a(b).position().top+e.canvasHeight]},this.status="shrunk",a(b).html('<div class="grouple-elems"></div><canvas class="grouple-canvas" width="'+this.canvasWidth+'" height="'+this.canvasHeight+'"></canvas>');var f=a(b).find("canvas")[0],g=f.getContext("2d");this.render=function(){e.circle(e.centerX,e.centerY,e.radiusOuterInit,e.settings.outerCircleInnerStrokeColor),e.stroke(e.settings.outerStrokeWidth,e.settings.outerStrokeColor),e.circle(e.centerX,e.centerY,e.radiusOuterInit-e.radiusCurrent*.03,e.settings.outerFillColor),e.circle(e.centerX,e.centerY,e.radiusInner,e.settings.innerFillColor),e.stroke(e.settings.innerStrokeWidth,e.settings.innerStrokeColor);for(var a=0;a<360;a+=45)e.items.push(e.subcircle(a,"profile_pic.png"))},this.expand=function(a,b,c){var d;if(c===undefined||c!=="-")c="+";if(c==="+"&&Math.floor(e.radiusCurrent)>=Math.floor(b)){this.status="expanded";return}if(c==="-"&&Math.ceil(e.radiusCurrent)<=Math.ceil(b)){this.status="shrunk";return}c==="+"?(e.radiusCurrent+=5,d=(e.radiusCurrent-a)/(b-a),this.status="expanding"):(e.radiusCurrent-=5,d=1-(a-e.radiusCurrent)/(a-b),this.status="shrinking"),e.clear(),e.circle(e.centerX,e.centerY,e.radiusCurrent,e.settings.outerCircleInnerStrokeColor),e.stroke(e.settings.outerStrokeWidth,e.settings.outerStrokeColor),e.circle(e.centerX,e.centerY,e.radiusCurrent-e.radiusCurrent*.03,e.settings.outerFillColor),e.circle(e.centerX,e.centerY,e.radiusInner,e.settings.innerFillColor),e.stroke(e.settings.innerStrokeWidth,e.settings.innerStrokeColor),e.expandSubsets(d),setTimeout(function(){e.expand(a,b,c)},5)},this.shrink=function(a,b){e.expand(a,b,"-")},this.expandSubsets=function(c){c===0?a(b).find(".grouple-elems").hide():a(b).find(".grouple-elems").show();var d=a("."+e.subsetClassName);d.css("background-size",e.elementBackgroundSize*c+"px auto"),d.css("height",Math.floor(e.radiusSubcircle()*c)+"px"),d.css("width",Math.floor(e.radiusSubcircle()*c)+"px"),d.css("border-radius",e.radiusCurrent*c+"px"),d.css("position","absolute"),d.css("left",9-e.radiusSubcircle()*c/2+"px"),d.css("top",9-e.radiusSubcircle()*c/2+"px");for(var f=0;f<e.items.length;f++){d=e.items[f];var g=e.angleAtIndex(f),h=e.coordinatesAtAngle(g,e.radiusCurrent-e.radiusSubcircle()*.7*c);a("#grouple-ce-outer-"+(f+1)).css("left",h.x+"px"),a("#grouple-ce-outer-"+(f+1)).css("top",h.y+"px")}},this.subcircle=function(a,b){var d=e.coordinatesAtAngle(a,e.radiusSubsetsRail);return new c(e,e.items.length+1,d.x,d.y,e.radiusSubcircle(),b)},this.coordinatesAtAngle=function(a,b){var c=Math.PI/180;return a*=c,{x:e.centerX+b*Math.cos(a),y:e.centerY+b*Math.sin(a)}},this.angleAtIndex=function(a){return a===0||e.items.length<1?0:360/e.items.length*a},a(window).mousemove(function(a){if(e.status==="expanding"||e.status==="shrinking")return;if(a.clientX>=e.bounds.x[0]&&a.clientX<=e.bounds.x[1]&&a.clientY>=e.bounds.y[0]&&a.clientY<=e.bounds.y[1]){if(e.status==="expanded")return;e.expand(e.radiusOuterInit,e.radiusOuterEnd);return}if(e.status==="shrunk")return;e.shrink(e.radiusOuterEnd,e.radiusOuterInit)}),this.circle=function(a,b,c,d){g.fillStyle=d,g.beginPath(),g.arc(a,b,c,0,Math.PI*2,!0),g.closePath(),g.fill()},this.stroke=function(a,b){if(a===0)return;g.lineWidth=a,g.strokeStyle=b,g.stroke()},this.clear=function(){g.clearRect(0,0,e.canvasWidth,e.canvasHeight)}},c=function(b,c,d,e,f,g){var h=this;this.parent=b,this.id=c,this.radius=f,this.render=function(){h.divCircle(d,e,f,g)},this.divCircle=function(b,c,d,e){var f="<div id='grouple-ce-outer-"+h.id+"' style='position:absolute;left:"+b+"px;top:"+c+"px;'>";f+="  <div class='"+h.parent.subsetClassName+"' style='background-image:url("+e+");background-size:"+h.elementBackgroundSize*0+"px auto;border-radius:20px;'></div>",f+="</div>",a(h.parent.container).find(".grouple-elems").append(f)},this.render()};a.fn.grouple=function(c){var d=this;return c=a.extend({},a.fn.grouple.options,c),this.opts=c,window.groupleIdCounter===undefined&&(window.groupleIdCounter=0),this.options=function(a){if(typeof a=="string")return c[a];if(typeof a=="object")for(var b in a)a.hasOwnProperty(b)&&(c[b]=a[b]);return d.refresh(),c},this.refresh=function(){},this.each(function(){if(a(this).data("grouple_instance")!==undefined)return;c.id=window.groupleIdCounter++;var d=new b(this,c);d.render(),a(this).data("grouple_instance",d)})},a.fn.grouple.options={innerStrokeWidth:1,innerStrokeColor:"#A9A9A9",outerStrokeWidth:1,outerStrokeColor:"#A9A9A9",innerFillColor:"#5E99CD",outerFillColor:"#EBEBEB",outerCircleInnerStrokeColor:"#FFFFFF",elementBackgroundSize:45}})(jQuery);